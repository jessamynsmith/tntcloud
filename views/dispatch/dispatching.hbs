<script language="javascript" type="text/javascript" src="/javascripts/p5/p5.min.js"></script>
<script language="javascript" src="/javascripts/p5/p5.dom.min.js"></script>

<!-- Title/Intro ------------------------------------------------------------>
<div class="section-intro">
  <h1>Dispatching</h2>
</div>

<!-- Primary Content -------------------------------------------------------->
<div id="table-and-search">

  <!-- Records list -->
  <table class="data-table stack">
    <thead>
      <th class="col2">RO</th>
      <th class="col5">Customer</th>
      <th class="col8">Failed Part #</th>
    </thead>
    <tbody id="records-list" class="list">
    <!--------------------------------------------------------------------------->
    <!-- Handlebars ------------------------------------------------------------->
    <!--------------------------------------------------------------------------->
<!--
      {{#each dispatchData }}
        <tr class="data-row" data-sort="{{DateTimeStampServer}}" id="{{@key}}">
          <td class="ro">{{RO}}</td>
          <td class="customer">{{Customer}}</td>
          <td class="failed-part-number">{{FailedPartNumber}}</td>
        </tr>
      {{/each}}
-->
    </tbody>
  </table>
</div>

<hr>

<ol id="scorelist"></ol>

<ul id="new-ul"></ul>

<div id="youtube-firebase"></div>


<script>


/*********************************
* p5 JS Library Initializer
*********************************/
function setup() {}


const divObject = document.getElementById('youtube-firebase');

const dbRefObject = firebase.database().ref().child('dispatch');

// Sync Object Changes
dbRefObject.on('value', snap => {
  divObject.innerText = JSON.stringify(snap.val(), null, 3);
});
/** Firebase Vid 2 ************************************************************/
/*
var ulList = document.getElementById('new-records');

var ref = firebase.database().ref().child('dispatch');

ref.on('child_added', snap => {
  var li = document.createElement('li');
  li.innerText = snap.val();
  ulList.appendChild(li);
});
*/

/*****************************************************************************
 * Retrieve core Records from Database
*****************************************************************************/

var ref = firebase.database().ref().child('dispatch');
// ref.on is firebase method for keeping live data, and 'value' is saying you want values
ref.on('value', gotData => {

  var scorelistings = selectAll('.scorelisting');
  for (var i = 0; i < scorelistings.length; i++) {
    scorelistings[i].remove();
  }

  // assign above core data to 'core'
  var core = gotData.val();
  // Firebase keys/records: assign the core object's Firebase keys to 'keys'
  var keys = Object.keys(core);
  // Loop through all the Keys/records
  for (var i = 0; i < keys.length; i++) {
    var k = keys[i];
    // Extract value from each Key record

    var Customer = core[k].Customer.toUpperCase();
//    var FailedPartNumber = core[k].FailedPartNumber.toUpperCase();
    var RO = core[k].RO.toUpperCase();
/*
    // create <td>
    var tdCustomer = document.createElement('td');
    tdCustomer.className += 'c-customer';
    var tCustomer = document.createTextNode(Customer);
    tdCustomer.appendChild(tCustomer);
    // create <td>
    var tdRo = document.createElement('td');
    tdRo.className += 'c-ro';
    var tRo = document.createTextNode(RO);
    tdRo.appendChild(tRo);
    console.log("Customer + RO ", tdCustomer, tdRo);
*/
    var tr = createElement('tr', `<td class="scorelisting">${RO}</td>`);
    tr.class('scorelisting');
    tr.parent('records-list');

/*

    var myRows = tr;
    console.log("TR OUTPUT ", myRows);
    var getThis = document.getElementById("records-list").appendChild(myRows);
*/
  } // End for Loop

}); // End gotData(data)

</script>
