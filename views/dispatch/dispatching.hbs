<script language="javascript" type="text/javascript" src="/javascripts/p5/p5.min.js"></script>
<script language="javascript" src="/javascripts/p5/p5.dom.min.js"></script>

<!-- Title/Intro ------------------------------------------------------------>
<div class="section-intro dispatch">
<!--  <h1>Dispatching</h2> -->
</div>

<!-- Two Columns -------------------------------------------------------------->
<div class="grid-x two-column">
  <!-- Column 1 --------------------------------------------------------------->
  <div class="small-6 cell col1">
    <h2>Requested</h2>
    <table class="data-table stack">
      <thead>
        <th class="col2">RO</th>
        <th class="col5">Customer</th>
        <th class="col8">Failed Part #</th>
      </thead>
      <tbody id="records-list" class="list">
      </tbody>
    </table>
  </div>
  <!-- Column 2 --------------------------------------------------------------->
  <div class="small-6 cell col2">
    <h2>Dispatched</h2>
    <table class="data-table stack">
      <thead>
        <th class="col2">RO</th>
        <th class="col5">Customer</th>
        <th class="col8">Failed Part #</th>
      </thead>
      <tbody id="records-list" class="list">
      </tbody>
    </table>
  </div>
</div>


<script>

/*********************************
* p5 JS Library Initializer
*********************************/
function setup() {}
/********************************/


/*****************************************************************************
 * Retrieve core Records from Database
*****************************************************************************/

var dbRef = firebase.database().ref().child('dispatch');

dbRef.on('value', gotData => {

  var dataRows = selectAll('.data-row');
  for (var i = 0; i < dataRows.length; i++) {
    dataRows[i].remove();
  }

  // assign above core data to 'data'
  var dataVal = gotData.val();
  // Firebase keys/records: assign the core object's Firebase keys to 'keys'
  var keys = Object.keys(dataVal);
  // Loop through all the Keys/records
  for (var i = 0; i < keys.length; i++) {
    var k = keys[i];

    // Extract value from each Key record
    var Customer = dataVal[k].Customer;
    var FailedPartNumber = dataVal[k].FailedPartNumber;
    var RO = dataVal[k].RO;

    var tr = createElement('tr',
     `<td>${RO}</td>
      <td>${Customer}</td>
      <td>${FailedPartNumber}</td>
    `);
    tr.class('data-row');
    tr.id(k);
    tr.parent('records-list');

  } // End for Loop
}); // End gotData(data)

</script>
