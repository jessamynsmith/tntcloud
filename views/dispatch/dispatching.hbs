<script language="javascript" type="text/javascript" src="/javascripts/p5/p5.min.js"></script>
<script language="javascript" src="/javascripts/p5/p5.dom.min.js"></script>

<!-- Title/Intro ------------------------------------------------------------>
<div class="section-intro">
  <h1>Dispatching</h2>
</div>

<!-- Primary Content -------------------------------------------------------->
<div id="table-and-search">

  <!-- Records list -->
  <table class="data-table stack">
    <thead>
      <th class="col2">RO</th>
      <th class="col5">Customer</th>
      <th class="col8">Failed Part #</th>
    </thead>
    <tbody id="records-list" class="list">
    <!--------------------------------------------------------------------------->
    <!-- Handlebars ------------------------------------------------------------->
    <!--------------------------------------------------------------------------->
<!--
      {{#each dispatchData }}
        <tr class="data-row" data-sort="{{DateTimeStampServer}}" id="{{@key}}">
          <td class="ro">{{RO}}</td>
          <td class="customer">{{Customer}}</td>
          <td class="failed-part-number">{{FailedPartNumber}}</td>
        </tr>
      {{/each}}
-->
    </tbody>
    <tfoot id="getTable"></tfoot>
  </table>
</div>

<hr>

<ul id="youtubeFB2"></ul>
<hr>
<div id="youtubeFB1"></div>

<script>

/*********************************
* p5 JS Library Initializer
*********************************/
function setup() {}
/********************************/
/*
const divObject = document.getElementById('youtubeFB1');

const dbRefObject = firebase.database().ref().child('dispatch');

// Sync Object Changes
dbRefObject.on('value', snap => {
  divObject.innerText = JSON.stringify(snap.val(), null, 3);
});
*/
/** Firebase Vid 2 ************************************************************/
/*
var getTable = document.getElementById('getTable');
var ulList = document.getElementById('youtubeFB2');

var dbRefDispatch = firebase.database().ref().child('dispatch');
// var dbRefList = dbRefDispatch.child('hobbies');

dbRefDispatch.on('child_added', function(data) {
// dbRefList.on('child_added', function(data) {

  RO = data.val().RO;
  Customer = data.val().Customer;

  // create <td>
  var tdRo = document.createElement('td');
  tdRo.className += 'c-ro';
  var tRo = document.createTextNode(RO);
  tdRo.appendChild(tRo);
  // create <td>
  var tdCustomer = document.createElement('td');
  tdCustomer.className += 'c-customer';
  var tCustomer = document.createTextNode(Customer);
  tdCustomer.appendChild(tCustomer);

  var tr = document.createElement('tr');
  tr.appendChild(tdRo);
  tr.appendChild(tdCustomer);
  tr.id = data.key;

  getTable.appendChild(tr);
});

dbRefDispatch.on('child_changed', snap => {
  var trChanged = document.getElementById(snap.key);
  trChanged.innerText = snap.val();
});

dbRefList.on('child_removed', snap => {
  var trToRemove = document.getElementById(snap.key);
  trToRemove.remove();
});
*/


/*****************************************************************************
 * Official Firebase Example App: "Database"
*****************************************************************************/
/*
// Listen for Items
var commentsRef = firebase.database().ref('post-comments/' + key);
commentsRef.on('child_added', function(data) {
  addCommentElement(postElement, data.key, data.val().text, data.val().author);
});

// Creates a comment element and adds it to the given postElement.
function addCommentElement(postElement, id, text, author) {
  var comment = document.createElement('div');
  comment.classList.add('comment-' + id);
  comment.innerHTML = '<span class="username"></span><span class="comment"></span>';
  comment.getElementsByClassName('comment')[0].innerText = text;
  comment.getElementsByClassName('username')[0].innerText = author || 'Anonymous';

  var commentsContainer = postElement.getElementsByClassName('comments-container')[0];
  commentsContainer.appendChild(comment);
}
*/


/*****************************************************************************
 * Retrieve core Records from Database
*****************************************************************************/

var dbRef = firebase.database().ref().child('dispatch');

dbRef.on('value', gotData => {

  var dataRows = selectAll('.data-row');
  for (var i = 0; i < dataRows.length; i++) {
    dataRows[i].remove();
  }

  // assign above core data to 'data'
  var dataVal = gotData.val();
  // Firebase keys/records: assign the core object's Firebase keys to 'keys'
  var keys = Object.keys(dataVal);
  // Loop through all the Keys/records
  for (var i = 0; i < keys.length; i++) {
    var k = keys[i];

    // Extract value from each Key record
    var Customer = dataVal[k].Customer;
    var FailedPartNumber = dataVal[k].FailedPartNumber;
    var RO = dataVal[k].RO;

    var tr = createElement('tr',
     `<td>${RO}</td>
      <td>${Customer}</td>
      <td>${FailedPartNumber}</td>
    `);
    tr.class('data-row');
    tr.id(k);
    tr.parent('records-list');

  } // End for Loop
}); // End gotData(data)

</script>
